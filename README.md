# ofismag
Тестовое задание на позицию младшего программиста PHP
Поставить решение «Интернет-магазин» из дистрибутива «1С-Битрикс: Управление сайтом - Бизнес».
1. Реализовать функционал сообщения об ошибке на сайте. Пользователь, находясь на любой странице сайта, выделяет текст с ошибкой и нажимает Ctrl+Enter. В ответ отображается окно подтверждения отправки сообщения об ошибке. После подтверждения, выделенный текст отправляется на электронную почту.
2. Реализовать сравнение товаров. В карточке товара должен быть индикатор «уже в сравнении», отдельная страница со сравнением выбранных товаров одинаковые характеристики товаров не должны отображаться при сравнении.
3. Реализовать функционал добавления товара в корзину по коду товара. Пользователь, переходит на новую страницу, в поле ввода указывает код товара и в ответ отображается название и цена товара. Указывает количества товара и нажимает кнопку "Добавить", в результате товар добавляется в корзину.
Создать проект в github или gitlab. В проект добавить только новые и измененные файлы (важно, весь bitrix грузить в проект не надо). Пояснение по реализации, настройке и использованию указать в файле readme.md.
Открыть публичный доступ к проекту и предоставить ссылку на проект.

На чем работал: 
- Стандартная демонстрационная версия битрикс бизнес на 30 дней, разворачивал через beget

Задание 1.
Создал скрипт wait_press_button.js, в котором написана логика через слушание событие keyup. 
В нем происходит проверка, что на страничке действительно был выделен какой-то текст, иначе всплывает сообщение с предупреждением, что для начала надо выделить текст и после этого нажимать комбинаию клавиш. Открывается форма (Форма размещена в файле header.php с классом "custom_modal"), где выводится выделенный текст, опциональное поле ввода правильного варианта от клиента , ссылка на страницу где был выделен текст и кнопка отправить. По нажатию на кнопку отправить делается запрос в файл send_email где уже по заранее созданому почтовому шаблону вызывается функция для отправки письма на почту.
По почтовым событиям:
В админке создал новый тип SEND_ERROR
Поля:
#TEXT_WITH_ERROR# - текст, где допущена ошибка
#URL# - Ссылка на страницу, где допущена ошибка
#CORRECT# - Правильный вариант, предложенный пользователем 
Создал по нему шаблон, который указываю в скрипте send_email.php
Скрипт подключал в header.php

Задание 2.
Стандартный механизм сравнения отключил
В шаблоне карточки товара вынес блок сравнения из условия , которая проверяте включен ли штатный механизм.
Первая функция compare_tov(id) вызывается при изменении состояния чекбокса для добавления или удаления товара из списка для сравнения. Она отправляет запрос на сервер через AJAX и передает значение id товара и действие (ADD_TO_COMPARE_LIST или DELETE_FROM_COMPARE_LIST) в файл list_compare.php для обновления списка сравнения и возвращает количество товаров в этом списке. После получения ответа от сервера, количество товаров обновляется на странице.

Вторая функция toggleCompareText(id) вызывается при изменении состояния чекбокса и изменяет текст в элементе span, который показывает статус товара - добавлен в сравнение или доступен для сравнения. Если состояние чекбокса равно "checked", то текст изменяется на "Добавлен", иначе на "Сравнить".

Задание 3.
Для решения данной задачи создал простой компонент product.addtocart и вызвал его на тестовой страничке:

<?$APPLICATION->IncludeComponent(
    "bitrix:product.addtocart",
    "",
    array(),
    false
);?>

Сама суть механизма простая: 
При помощи трех базовых функций получаем цену и название товара по его ID + добавил вывод остатков товара на текущий момент. Если товар есть в наличии и количество товара, введенное пользователем <= остаткам то товар успешно добавляется  при помощи штатного метода в корзину, если нет выходит сообщение о том, что остатков товара не хватает. Плюс ко всему, если введен несуществующий айди товара также появится сообщение, что такой товар не найден.


